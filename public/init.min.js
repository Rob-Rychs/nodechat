require.config({paths:{jquery:"/lib/jquery-2.2.3.min",jquery_cookie:"/lib/jquery.cookie.min",text:"/lib/text.min",socket_io:"/socket.io/socket.io",css:"/lib/css.min"},shim:{socket_io:{exports:"io"}}}),require(["socket_io","jquery","text","css","jquery_cookie","/body.min.js","/style.css"],function(a){window.doc=new Body,require(["/table.min.js","/button.min.js","/textarea.min.js","/linklabel.min.js","/label.min.js","/textfield.min.js","/chat.min.js","/fileUploadButton.js"],function(b,c,d,e,f,g,h,i){function j(a){a||(a="/"),history.pushState(a,a,a)}var k=new b,l=new b,m=new b,n=new b,o=new b,p=new b,q=new d,r=new g,s=(new c("Илгээх"),new c("Нэвтрэх")),t=new c("Бүртгүүлэх");doc.append(k),q._view.addClass("TextArea"),r._view.addClass("TextField"),k.addRow(),k.addRow(),k.addCell(0),k.addCell(1),k.addCellContent(0,0,l),k.addCellContent(1,0,m),l.addRow(),l.addCell(0),l.addCellContentOneRow(0,0,s),l.addCellContentOneRow(0,0,t),m.addRow(),m.addCell(0),m.addCell(0),m.addCell(0),m.addCellContentOneRow(0,0,o),m.addCellContentOneRow(0,1,n),m.addCellContentOneRow(0,2,p);var u=new f("ХЭРЭГЛЭГЧИЙН МЭДЭЭЛЭЛ");u._view.addClass("infoHeader"),o.addRow(),o.addRow(),o.addCell(0),o.addCell(1),o.addCellContent(0,0,u);var v=new f("ГРҮПП ЧАТ");v._view.addClass("groupChatHeader"),n.addRow(),n.addRow(),n.addRow(),n.addCell(0),n.addCell(1),n.addCell(2),n.addCellContent(0,0,v),n.addCellContent(1,0,q),n.addCellContentOneRow(2,0,r);var w=new f("ОНЛАЙН ХЭРЭГЛЭГЧИД");w._view.addClass("buddyHeader"),p.addRow(),p.addRow(),p.addCell(0),p.addCell(1),p.addCellContent(0,0,w),k._view.addClass("mainTable"),l._view.addClass("headerTable"),m._view.addClass("chatTable"),o._view.addClass("infoTable"),n._view.addClass("groupChatTable"),p._view.addClass("buddyTable"),k._view.hide(),window.socket=a.connect();var x,y,z,A={};window.chatWindows={},socket.on("connect",function(){function a(a){z=a.target.files[0],console.log(z),chatTextArea.appendText(z.name)}function i(){x=new FileReader,chatTextArea.appendText(y),x.onload=function(a){socket.emit("Upload",{Name:name,Data:a.target.result})},console.log("About to send Start"),socket.emit("Start",{Name:name,Size:z.size})}socket.on("InitSession",function(j){if(jQuery.cookie("SessionID",j.sid,{path:"/"}),1!=j.authorized)require(["login.js"],function(a){k._view.hide();new a});else{k._view.show(),socket.emit("LoginClient",j.name);var l=new f(j.name);o.addCellContentOneRow(1,0,l)}socket.on("OnlineUsers",function(j){var k=JSON.parse(j),l=new b;l._view.addClass("onlineUsersTable"),k.forEach(function(b,j){l.addRow(),l.addCell(j);var k=new e;k.setText(b.name),l.addCellContent(j,0,k),jQuery(r._view).keypress(function(a){if(13==a.keyCode){var b=r.getText(),c={text:b};socket.emit("PublicMessage",JSON.stringify(c)),q.appendText(name+" : "+b),r.setText("")}}),socket.on("PublicMessage",function(a){var b=JSON.parse(a);q.appendText(b.name+" : "+b.text+" at "+b.date),console.log("Message"+b.name+" : "+b.text+" at "+b.date)}),jQuery(k._view).on("click",function(){if(A={name:b.name,id:b.id},chatWindows[b.id])alert("Already");else{var a=new h,e=new f("user"),i=new d,j=new g,k=new c("X"),l=new c("_"),m=new c("[]");m._view.hide(),e._view.addClass("chatText"),i._view.addClass("chatTextArea"),j._view.addClass("chatTextField"),k._view.addClass("closeButton"),l._view.addClass("hideButton"),m._view.addClass("showButton"),chatWindows[b.id]=a,chatWindows[b.id]._view.css({right:150*Object.keys(chatWindows).length+"px"}),$(j._view).keypress(function(a){if(13==a.keyCode){var b=j.getText(),c={text:b,end_client:A.id};socket.emit("Message",JSON.stringify(c)),i.appendText(b),j.setText("")}}),socket.on("Message",function(a){var b=JSON.parse(a);i.appendText(b.text+" at "+b.date)}),$(k._view).on("click",function(){delete chatWindows[b.id],a._view.remove(),delete a}),$(l._view).on("click",function(){i._view.remove(),j._view.remove(),chatSendButton._view.remove(),l._view.remove(),m._view.show()}),$(m._view).on("click",function(){e._view.show(),i._view.show(),j._view.show(),chatSendButton._view.show(),k._view.show(),l._view.show(),m._view.remove()}),a.addControl(i),a.addControl2(j),a.addControl5(e),a.addControl6(l),a.addControl4(k),a.addControl1(m),e.setText(A.name)}}),socket.on("ChatWindow",function(e){function j(){window.File&&window.FileReader?($(chatFileUploadButton._view).addEventListener("click",i),$(chatFileUploadButton._view).addEventListener("change",a)):alert("HI")}if(A={name:b.name,id:b.id},chatWindows[b.id])alert("Already");else{var k=new h,l=new f("user"),m=new d,n=new g,o=new c(""),p=new c(""),q=new c("");q._view.hide(),window.addEventListener("load",j),l._view.addClass("chatText"),m._view.addClass("chatTextArea"),n._view.addClass("chatTextField"),o._view.addClass("closeButton"),p._view.addClass("hideButton"),q._view.addClass("showButton"),chatWindows[A.id]=k,chatWindows[A.id]._view.css({right:150*Object.keys(chatWindows).length+"px"}),$(n._view).keypress(function(a){if(13==a.keyCode){var b=n.getText(),c={text:b,end_client:A.id};socket.emit("Message",JSON.stringify(c)),m.appendText(b),n.setText("")}}),socket.on("Message",function(a){var b=JSON.parse(a);m.appendText(b.text+" at "+b.date)}),$(o._view).on("click",function(){delete chatWindows[b.id],k._view.remove()}),$(p._view).on("click",function(){m._view.remove(),n._view.remove(),chatSendButton._view.remove(),p._view.remove(),q._view.show()}),$(chatFileUploadButton).on("click",function(){z=evnt.target.files[0],console.log(z),m.appendText(z.name)}),$(q._view).on("click",function(){l._view.show(),m._view.show(),n._view.show(),chatSendButton._view.show(),o._view.show(),p._view.show(),q._view.remove()}),k.addControl(m),k.addControl2(n),k.addControl5(l),k.addControl6(p),k.addControl4(o),k.addControl1(q),l.setText(A.name)}})}),p.addCellContent(1,0,l)})}),jQuery(s._view).click(function(){require(["login.js"],function(a){var b=new a;b.url="/login",j(this.url),k._view.hide()})}),jQuery(t._view).click(function(){require(["register.js"],function(a){var a=new a;a.url="/register",j(this.url),k._view.hide()})}),socket.on("MainShow",function(){k._view.show()}),socket.on("MoreData",function(a){var b,c=524288*a.Place;b=z.webkitSlice?z.webkitSlice(c,c+Math.min(524288,z.size-c)):z.slice(c,c+Math.min(524288,z.size-c)),fReader.readAsBinaryString(b)})}),window.onbeforeunload=function(){socket.emit("disconnect")}})});